# Классификация поражений кожи при помощи методов глубинного обучения
**Постановка задачи:** Написание веб-сервиса на python с возможностью обработки загруженных
фотографий поражений кожи и выдачи прогноза наиболее вероятного заболевания.   
**Автор работы:** Комутков Илья Сергеевич, студент МОВС2022   
**Научный руководитель:** Бардуков Анатолий Андреевич, аспирант ВШЭ ФКН   
**План выполнения ВКР:**
1. Изучение статей на тему распознавания медицинских изображений, анализ решений на рынке (Этап выполнен).   
* Было найдено много обзорных статей на тему применения искусственного интеллекта в медицине, однако лишь в нескольких
статьях рассматриваются конкретные решения с актуальными нейронными сетями и описанием областей их применения. В статье 
[CLIP in medical imaging: A comprehensive survey](https://arxiv.org/pdf/2312.07353.pdf) описано большое количество способов
применения CLIP для медицинских задач, актуальными для распознавания поражений кожи являются решение задачи классификации,
сегментации и генерации отчета на основе фото.
* В статье [Parameter-Efficient Fine-Tuning for Medical Image Analysis: The Missed Opportunity](https://arxiv.org/pdf/2305.08252.pdf)
рассматриваются подходы файнтюнинга моделей компьютерного зрения для решения медицинских задач. Этот подход очень актуален
для больших моделей при необходимости достичь высокого качества распознавания.
* Одним из лучших показателей точности для задачи распознавания болезни кожи обладает модель [FixCaps](https://ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=9791221).
* На российском рынке самым известным решением является сервис по распознаванию поражений кожи от 
[СберМедИИ](https://sbermed.ai/our-algorithms/skin). Однако данный сервис обладает набором недостатков: функциональность
ограничена классификацией, сервис доступен только компаниям. **В ВКР планируется помимо классификации реализовать выделение
области картинки с поражением, предложить решение для любого пациента без необходимости привязываться к конкретной
медицинской компании, а также при условии успешных экспериментов добавить генерацию отчета на основе загруженной 
фотографии.**
2. Эксперименты с моделями глубинного обучения (**Этап выполнен, эксперименты в папке experiments**).   
В первую очередь были проведены эксперименты для решения задачи классификации.   
Бейзлайном была выбрана ResNet50 переобученная для классификации 7 болезней с accuracy=0.85 
на тестовой выборке.
В ходе экспериментов сравнивалась точность классификации следующих моделей:
* zero-shot классификации при помощи CLIP 
* Переобученная модель [ViT base](https://huggingface.co/timm/vit_base_patch16_224.augreg2_in21k_ft_in1k)
* Классификатор SVM, обученный на эмбеддингах ViT [base](https://huggingface.co/timm/vit_base_patch14_dinov2.lvd142m)/
[large](https://huggingface.co/timm/vit_large_patch14_dinov2.lvd142m), которые обучены с использованием метода
DINOv2
* Классификатор SVM, обученный на эмбеддингах [Swin v2](https://huggingface.co/timm/swinv2_base_window8_256.ms_in1k)
* Вышеописанный ViT base с DINOv2 переобученный с помощью метода lora 
с заморозкой всех слоев кроме головы (линейный слой для определения класса)
* Модель [FixCaps](https://ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=9791221), основанная на использовании сверточных слоев с большим размером сверточного ядра.

Результаты практически всех моделей оказались хуже бейзлайна, а переобучение трансформеров занимало также
значительно больше времени, что не позволило бы добавить в модель функционал переобучения. Только модель FixCaps
с аугментациями из вышеописанной статьи позволила достичь точности 0.928, поэтому в сервисе было решено использовать
эту архитектуру.

Для решения задачи сегментации была использована модель YOLOv8 с метриками `mAP50 = 0.993, mAP50-95 = 0.859` на тестовой выборке.

3. Реализация сервиса с возможностью загрузить фотографию кожного 
заболевания и получить предсказание на основе модели с выделенной областью поражения (**Этап выполнен, инструкция по запуску проекта в папке lesions_projects**)
4. Настройка Docker, БД, покрытие тестами и настройка nginx для хранения медиа файлов, дедлайн 19 мая 23:59:59
5. Написание текста ВКР, дедлайн 1 июня 23:59:59   

**Описание [данных](https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/DBW86T):**
Датасет содержит 10000 изображений с 7 вариантами кожных заболеваний
* Актинические кератозы и внутриэпителиальный рак / заболевание Боуэна - ```akiec```
* Базалиома - ```bcc```
* Доброкачественные кератозоподобные образования (солнечные лентиго / себорейные кератозы и кератозоподобные образования лишай-плануса) - ```bkl```
* Дерматофиброма - ```df```
* Меланома - ```mel```
* Меланоцитарные родинки - ```nv```
* Сосудистые образования (ангиомы, ангиокератомы, грануломы пиогенной природы и кровоизлияния) - ```vasc```
 
Более 50% диагнозов кожных изменений выявлены гистопатологией (histo), способами определения заболеваний
для остальных случаев являются последующий осмотр (follow_up), экспертное согласие (consensus), 
либо подтверждение методом конфокальной микроскопии (confocal). Способ определения диагноза можно узнать
в файле с метками классов.   

